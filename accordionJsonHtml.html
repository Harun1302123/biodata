<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Accordion Example</title>
<style>
  input[type="text"],
  input[type="number"],
  input[type="email"],
  input[type="url"],
  input[type="password"],
  input[type="search"],
  input[type="reset"],
  input[type="tel"],
  input[type="date"],
  select,
  textarea {
    width: 60%;
  }

  .custom-input {
    margin: 2px;
    padding: 10px;
    width: 60%;
    font-size: 17px;
    border: 1px solid #aaaaaa;
  }

  .custom-input-label {
    padding: 10px;
    font-size: 17px;
    border: 1px solid #aaaaaa;
  }

  .editable-label-input {
    border: none !important;
    outline: none !important;
    box-shadow: none !important;
    font-size: 18px;
    background-color: transparent;
    text-align: left;
  }

  .input-group {
    display: inline-block;
    width: 30%;
  }

  .col-2 {
    display: inline-block;
    width: 30%;
  }

  .col-1 {
    display: inline-block;
    width: 26%;
  }

  /* Accordion styles start */
  .custom-accordion-header {
    background-color: #007bff;
    color: white;
    cursor: pointer;
    padding: 15px;
    text-align: left;
    border: none;
    outline: none;
    font-size: 16px;
    width: 100%;
    transition: background-color 0.3s ease;
  }

  .custom-accordion-header:hover {
    background-color: #0056b3;
  }

  .custom-accordion-content {
    padding: 5px;
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
    box-shadow: none !important;
  }

  .accordion-content-body {
    padding: 20px;
    overflow: hidden;
  }

  .navigation-buttons {
    text-align: center;
    margin-top: 20px;
  }

  .navigation-buttons button {
    background-color: #007bff;
    color: white;
    border: none;
    padding: 10px 20px;
    font-size: 16px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    margin: 0 5px;
  }

  .navigation-buttons button:hover {
    background-color: #0056b3;
  }

  .navigation-buttons button:disabled {
    background-color: #d3d3d3;
    cursor: not-allowed;
  }

  /* Accordion styles end */

  /* Add row styles start */
  .field-container {
    margin-bottom: 10px;
  }

  .remove-button {
    background-color: red;
    color: white;
    border: none;
    cursor: pointer;
    padding: 7px 10px;
    border-radius: 50%;
    margin-right: 10px;
    margin-left: 10px;
  }

  .add-button {
    margin-top: 20px;
    padding: 10px 20px;
    background-color: green;
    color: white;
    border: none;
    cursor: pointer;
  }

  /* Add row styles end */

  /* Container for the toggle switch */
  .toggle-container {
    display: flex;
    align-items: center;
  }

  /* Hide the default checkbox */
  .toggle-checkbox {
    display: none;
  }

  /* Styling for the label */
  .toggle-label {
    display: inline-block;
    cursor: pointer;
    position: relative;
    width: 42px;
    height: 16px;
  }

  /* Styling for the slider */
  .toggle-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: 0.4s;
    border-radius: 34px;
  }

  /* Styling for the slider before it's checked */
  .toggle-slider:before {
    position: absolute;
    content: "";
    height: 15px;
    width: 15px;
    border-radius: 50%;
    background-color: white;
    transition: 0.4s;
  }

  /* Change slider background color and position when checked */
  .toggle-checkbox:checked + .toggle-label .toggle-slider {
    background-color: #4caf50;
  }

  .toggle-checkbox:checked + .toggle-label .toggle-slider:before {
    transform: translateX(26px);
  }
</style>
</head>
<body>
<div id="form-container"></div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script>
  function addField(id) {
    const container = document.getElementById("fields-container-" + id);
    if (!container) {
      console.error("Container not found for id: ", id);
      return;
    }
    const row = container.children.length + 1;
    const fieldDiv = document.createElement("div");
    const removeButton = document.createElement("button");
    removeButton.textContent = "X";
    removeButton.classList.add("remove-button");

    const newField = document.createElement("span");
    newField.innerHTML = `
      <div class="col-1">
        <input type="text" id="editable-label-addrow-${id}-${row}" class="custom-input-label" value="Description">
      </div>
      <input type="text" id="input-field-addrow-${id}-${row}" class="custom-input" placeholder="Enter Description">
    `;

    removeButton.onclick = function () {
      container.removeChild(fieldDiv);
    };

    fieldDiv.appendChild(removeButton);
    fieldDiv.appendChild(newField);
    container.appendChild(fieldDiv);

    const labelInputAddRow = document.getElementById(
      `editable-label-addrow-${id}-${row}`
    );
    const inputFieldAddRow = document.getElementById(
      `input-field-addrow-${id}-${row}`
    );

    if (labelInputAddRow && inputFieldAddRow) {
      labelInputAddRow.addEventListener("input", function () {
        inputFieldAddRow.placeholder = `Enter ${labelInputAddRow.value}`;
      });
    }
  }

  function accordionBtn() {
    const headers = document.querySelectorAll(".custom-accordion-header");
    const contents = document.querySelectorAll(".custom-accordion-content");
    const allPrevBtns = document.querySelectorAll(".prevBtn");
    const allNextBtns = document.querySelectorAll(".nextBtn");

    let currentIndex = 0;

    function openSection(index) {
      contents.forEach((content, i) => {
        if (i === index) {
          content.style.maxHeight = "100%";
          headers[i].classList.add("active");
        } else {
          content.style.maxHeight = null;
          headers[i].classList.remove("active");
        }
      });
      updateButtons(index);
    }

    function updateButtons(index) {
      allPrevBtns.forEach((btn, i) => {
        btn.disabled = i !== index && i < index;
      });
      allNextBtns.forEach((btn, i) => {
        btn.disabled = i !== index && i > index;
      });
    }

    headers.forEach((header, index) => {
      header.addEventListener("click", () => {
        openSection(index);
        currentIndex = index;
      });
    });

    allPrevBtns.forEach((btn, index) => {
      btn.addEventListener("click", () => {
        if (currentIndex > 0) {
          currentIndex--;
          openSection(currentIndex);
        }
      });
    });

    allNextBtns.forEach((btn, index) => {
      btn.addEventListener("click", () => {
        if (currentIndex < contents.length - 1) {
          currentIndex++;
          openSection(currentIndex);
        }
      });
    });

    openSection(0);
  }
  function toggleBtn() {
    const inputGroups = document.querySelectorAll(".input-group");
    inputGroups.forEach((group) => {
      const labelInput = group.querySelector(".editable-label-input");
      const inputField = group.nextElementSibling;
      const checkbox = group.querySelector(".toggle-checkbox");
      inputField.addEventListener("input", function () {
        checkbox.checked = true;
      });
      labelInput.addEventListener("input", function () {
        inputField.placeholder = `Enter ${labelInput.value}`;
      });
      const toggleLabel = group.querySelector(".toggle-label");
      toggleLabel.addEventListener("click", function () {
        checkbox.checked = !checkbox.checked;
      });
    });
  }

  $(document).ready(function () {
    formBuilder.buildForm("form-container", configuration);
    accordionBtn();
    toggleBtn();
  });

  var configuration = {
    action: "/biodata.html",
    method: "post",
    onValidSubmit: function (formState) {
      console.error("YAY a success!!", formState);
      sessionStorage.setItem("formData", JSON.stringify(formState));
    },
    sections: [
      {
        id: "section1",
        color: "green",
        title: "Personal Details",
        inputs: [
          {
            title: "full",
            id: "input-full",
            type: "text",
          },
        ],
      },
      {
        id: "section2",
        color: "red",
        title: "Title",
        inputs: [
          {
            title: "Ex 1",
            id: "input-ex1",
            type: "text",
          },
        ],
      },
      // Add more sections as needed
    ],
  };

  var formBuilder = (function () {
    function buildForm(containerId, config) {
      var formState = getInitialFormState(
        config.sections.flatMap((section) => section.inputs)
      );

      function getInitialFormState(inputs) {
        return inputs.reduce(function (state, config) {
          state[config.id] = config.defaultValue || "";
          return state;
        }, {});
      }

      function renderInput(config) {
        var renderMethods = {
          text: renderTextInput,
        };
        var renderMethod = renderMethods[config.type] || renderMethods.text;
        return renderMethod(config);
      }

      function renderForm() {
        var $form = $('<form class="form-builder-content"></form>').prop({
          action: config.action,
          method: config.method,
        });
        var $accordion = $('<div class="custom-accordion"></div>');

        config.sections.forEach((section) => {
          var $accordionItem = $(
            `<div class="custom-accordion-item" id="${section.id}">
              <button type="button" class="custom-accordion-header" style="background-color: ${section.color}">
                ${section.title}
              </button>
              <div class="custom-accordion-content">
                <div class="accordion-content-body">
                  ${section.inputs.map(renderInput).join("")}
                  ${accordionBtnDiv(section.id)}
                </div>
              </div>
            </div>`
          );
          $accordion.append($accordionItem);
        });

        $form.append($accordion);
        $form.append(renderSubmitButton());
        $(`#${containerId}`).html($form);
      }

      function accordionBtnDiv(id) {
        return `
        <div id="fields-container-${id}"></div>
        <button type="button" class="add-button" onclick="addField('${id}')">Add New Field</button>
        <div class="navigation-buttons">
          <button type="button" class="prevBtn">Previous</button>
          <button type="button" class="nextBtn">Next</button>
        </div>`;
      }

      function renderTextInput(config) {
        return `
        <div class="input-group">
          <input type="checkbox" class="toggle-checkbox" id="toggle-${config.id}" />
          <label class="toggle-label" for="toggle-${config.id}">
            <span class="toggle-slider"></span>
          </label>
          <label class="editable-label" for="label-${config.id}">&#9998;</label>
          <input type="text" class="editable-label-input" value="${config.title}" id="label-${config.id}" />
        </div>
        <input type="${config.type}" class="custom-input" id="${config.id}" placeholder="Enter ${config.title}" />
        `;
      }

      function renderSubmitButton() {
        return `<div class="text-right"><button id="form-submit-button" type="submit">Submit</button></div>`;
      }

      function addEventHandlers() {
        $(`#${containerId}`)
          .on("focusout", ".custom-input", handleInputChange)
          .on("focusout", ".editable-label-input", handleInputChange)
          .on("focusout", ".toggle-checkbox", handleInputChange)
          .on("click", "#form-submit-button", handleSubmit);
      }

      function handleInputChange(event) {
        updateInputAndValidate(event.target.id, event.target.value);
      }

      function updateInputAndValidate(id, value) {
        formState[id] = value;
      }

      function handleSubmit(event) {
        validateAll();
        if (!isFormValid()) {
          event.preventDefault();
        } else {
          config.onValidSubmit && config.onValidSubmit(formState);
        }
      }

      function validateAll() {
        Object.keys(formState).map(validateField);
      }

      function isFormValid() {
        var valid = true;
        Object.keys(formState).map(function (id) {
          if (formErrors[id]) {
            valid = false;
          }
        });
        return valid;
      }

      (function init() {
        renderForm();
        addEventHandlers();
      })();
    }

    return {
      buildForm: buildForm,
    };
  })();
</script>
</body>
</html>
